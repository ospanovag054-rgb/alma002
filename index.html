<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–ª–º–∞ | –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –°–∏—Å—Ç–µ–º–∞ –ê–Ω–∞–ª–∏–∑–∞</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- DYNAMIC THEME 2025 --- */
        :root {
            --glass-bg: rgba(13, 20, 35, 0.7); /* –¢–µ–º–Ω–æ–µ —Å—Ç–µ–∫–ª–æ */
            --glass-border: rgba(255, 255, 255, 0.1);
            --primary: #3b82f6;      /* –ù–µ–æ–Ω–æ–≤—ã–π —Å–∏–Ω–∏–π */
            --primary-glow: rgba(59, 130, 246, 0.5);
            --accent: #10b981;       /* –ù–µ–æ–Ω–æ–≤—ã–π –∑–µ–ª–µ–Ω—ã–π */
            --danger: #ef4444;
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --card-radius: 24px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }

        body {
            background-color: #0f172a;
            color: var(--text-main);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- –§–û–ù–û–í–û–ï –í–ò–î–ï–û (–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å) --- */
        .video-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }
        .video-bg {
            width: 100%; height: 100%; object-fit: cover;
            opacity: 0.85; /* –°–¥–µ–ª–∞–ª–∏ —è—Ä—á–µ */
            filter: contrast(1.1) saturate(1.1); /* –°–æ—á–Ω–µ–µ —Ü–≤–µ—Ç–∞ */
        }
        .video-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            /* –ì—Ä–∞–¥–∏–µ–Ω—Ç —Ç–æ–ª—å–∫–æ —Å–Ω–∏–∑—É, —á—Ç–æ–±—ã –≤–µ—Ä—Ö –±—ã–ª —á–∏—Å—Ç—ã–º */
            background: linear-gradient(to bottom, rgba(15, 23, 42, 0.2) 0%, rgba(15, 23, 42, 0.95) 90%);
        }

        /* --- UI COMPONENTS --- */
        .container { max-width: 1600px; margin: 0 auto; padding: 0 2rem; position: relative; z-index: 2; }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .glass-panel:hover {
            border-color: rgba(59, 130, 246, 0.3);
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        }

        /* --- HEADER --- */
        header { padding: 3rem 0; display: flex; justify-content: space-between; align-items: center; }
        
        .brand h1 {
            font-size: 3rem; font-weight: 800; letter-spacing: -1px;
            background: linear-gradient(90deg, #fff, var(--primary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }
        .brand p { color: var(--text-muted); font-size: 1.1rem; letter-spacing: 2px; text-transform: uppercase; }

        /* –ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
        .music-btn {
            background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
            color: white; padding: 12px 24px; border-radius: 50px; cursor: pointer;
            display: flex; align-items: center; gap: 10px; font-weight: 600;
            backdrop-filter: blur(10px); transition: 0.3s;
        }
        .music-btn:hover { background: var(--primary); box-shadow: 0 0 20px var(--primary-glow); border-color: var(--primary); }
        .bars { display: flex; gap: 3px; height: 16px; align-items: flex-end; }
        .bar { width: 3px; background: #fff; animation: none; height: 3px; }
        .playing .bar { animation: sound 0.5s infinite alternate; }
        .playing .bar:nth-child(2) { animation-delay: 0.2s; } 
        .playing .bar:nth-child(3) { animation-delay: 0.4s; }
        @keyframes sound { from { height: 3px; } to { height: 100%; } }

        /* --- GRID LAYOUT --- */
        .main-layout {
            display: grid; grid-template-columns: 350px 1fr; gap: 2rem; margin-bottom: 4rem;
        }

        /* --- ALMA SIDEBAR --- */
        .alma-container { position: sticky; top: 2rem; }
        
        .alma-avatar {
            overflow: hidden; padding: 0; position: relative;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.15);
        }
        .alma-video-wrapper {
            width: 100%; aspect-ratio: 9/16; position: relative;
        }
        .alma-video { width: 100%; height: 100%; object-fit: cover; }
        
        .alma-info {
            padding: 1.5rem; text-align: center;
            background: linear-gradient(to top, rgba(13,20,35,0.95), transparent);
            position: absolute; bottom: 0; left: 0; width: 100%;
        }
        .alma-badge {
            display: inline-block; padding: 4px 12px; border-radius: 20px;
            background: var(--primary); color: white; font-size: 0.7rem; font-weight: 800;
            margin-bottom: 10px; text-transform: uppercase; box-shadow: 0 0 10px var(--primary-glow);
        }

        /* --- MAIN CONTENT AREA --- */
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-pills {
            display: inline-flex; background: rgba(0,0,0,0.4); padding: 5px; border-radius: 60px;
            margin-bottom: 2rem; border: 1px solid var(--glass-border);
        }
        .nav-item {
            padding: 12px 30px; border-radius: 50px; color: var(--text-muted); border: none;
            background: transparent; cursor: pointer; font-weight: 600; transition: 0.3s;
            display: flex; gap: 8px; align-items: center; font-size: 1rem;
        }
        .nav-item:hover { color: white; background: rgba(255,255,255,0.05); }
        .nav-item.active { background: var(--primary); color: white; box-shadow: 0 4px 15px var(--primary-glow); }

        /* –°–µ–∫—Ü–∏–∏ */
        .section { display: none; animation: fadeInUp 0.6s ease-out; }
        .section.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* KPI Cards */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .kpi-card { padding: 1.5rem; display: flex; flex-direction: column; justify-content: center; }
        .kpi-val { font-size: 2.8rem; font-weight: 800; margin: 10px 0; background: linear-gradient(90deg, #fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .kpi-sub { font-size: 0.9rem; color: var(--text-muted); display: flex; align-items: center; gap: 5px; }
        .trend-up { color: var(--accent); } .trend-down { color: var(--danger); }

        /* –ì—Ä–∞—Ñ–∏–∫–∏ */
        .chart-box { padding: 2rem; height: 500px; position: relative; margin-bottom: 2rem; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ) */
        .controls-wrapper { display: flex; gap: 10px; background: rgba(0,0,0,0.3); padding: 4px; border-radius: 12px; }
        .control-btn {
            padding: 8px 16px; background: transparent; border: 1px solid transparent;
            color: var(--text-muted); border-radius: 8px; cursor: pointer; transition: 0.2s;
            font-size: 0.9rem;
        }
        .control-btn:hover { color: white; }
        /* –ö–ª–∞—Å—Å active —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç —á–µ—Ç–∫–æ –≤–∏–¥–µ–Ω */
        .control-btn.active { 
            background: var(--primary); 
            color: white; 
            box-shadow: 0 2px 10px var(--primary-glow);
            border-color: var(--primary);
        }

        /* –ù–æ–≤—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏ */
        .insights-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-top: 2rem; }
        .insight-box { padding: 1.5rem; }
        .insight-title { display: flex; align-items: center; gap: 10px; margin-bottom: 1rem; font-size: 1.1rem; font-weight: 600; color: white; }
        .insight-bar-bg { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin: 10px 0; overflow: hidden; }
        .insight-bar-fill { height: 100%; border-radius: 4px; }

        /* –ö–∞—Ä—Ç–∞ */
        #map { width: 100%; height: 500px; border-radius: 16px; z-index: 1; }

        /* --- –ß–ê–¢ –ë–û–¢ (–ê–õ–ú–ê) --- */
        .chat-widget {
            position: fixed; bottom: 30px; right: 30px; width: 400px; height: 600px;
            display: flex; flex-direction: column; z-index: 100;
            transform: translateY(120%); transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            border: 1px solid rgba(59, 130, 246, 0.4);
        }
        .chat-widget.open { transform: translateY(0); }
        
        .chat-header {
            padding: 1.5rem; background: rgba(13, 20, 35, 0.95); border-bottom: 1px solid var(--glass-border);
            display: flex; align-items: center; gap: 15px; border-radius: 24px 24px 0 0;
        }
        .chat-avatar-small { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary); }
        
        .chat-body { flex: 1; padding: 1.5rem; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 85%; padding: 12px 18px; border-radius: 18px; font-size: 0.95rem; line-height: 1.5; position: relative; }
        .msg.alma { background: rgba(255,255,255,0.1); color: #fff; align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid rgba(255,255,255,0.05); }
        .msg.user { background: var(--primary); color: white; align-self: flex-end; border-bottom-right-radius: 4px; box-shadow: 0 4px 15px var(--primary-glow); }
        
        .chat-footer { padding: 1rem; border-top: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); border-radius: 0 0 24px 24px; }
        .input-group { display: flex; gap: 10px; position: relative; }
        .input-group input { 
            flex: 1; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); 
            padding: 12px 20px; border-radius: 50px; color: white; outline: none; transition: 0.3s;
        }
        .input-group input:focus { border-color: var(--primary); background: rgba(0,0,0,0.4); }
        .send-btn { 
            width: 45px; height: 45px; border-radius: 50%; border: none; background: var(--primary); 
            color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s;
        }
        .send-btn:hover { transform: scale(1.1); box-shadow: 0 0 15px var(--primary-glow); }

        .chat-toggle-btn {
            position: fixed; bottom: 30px; right: 30px; width: 65px; height: 65px;
            background: var(--primary); border-radius: 50%; border: none; cursor: pointer;
            box-shadow: 0 0 30px var(--primary-glow); z-index: 101; transition: 0.4s;
            display: flex; align-items: center; justify-content: center; font-size: 1.8rem; color: white;
        }
        .chat-toggle-btn:hover { transform: scale(1.1) rotate(15deg); }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 1024px) {
            .main-layout { grid-template-columns: 1fr; }
            .alma-container { display: none; } /* –°–∫—Ä—ã–≤–∞–µ–º –±–æ–ª—å—à—É—é –ê–ª–º—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö, –æ—Å—Ç–∞–≤–ª—è–µ–º —á–∞—Ç */
            .chat-widget { width: calc(100% - 40px); bottom: 100px; right: 20px; }
            header { flex-direction: column; gap: 20px; text-align: center; }
        }
    </style>
</head>
<body>

    <div class="video-wrapper">
        <video class="video-bg" autoplay muted loop playsinline>
            <source src="WhatsApp Video 2025-12-16 at 17.41.28.mp4" type="video/mp4">
        </video>
        <div class="video-overlay"></div>
    </div>

    <audio id="bg-music" loop>
        <source src="Breaking News.mp3" type="audio/mpeg">
    </audio>

    <div class="container">
        <header>
            <div class="brand">
                <h1>–ê–õ–ú–ê–¢–´ 2025</h1>
                <p>–¶–∏—Ñ—Ä–æ–≤–æ–π –∞–Ω–∞–ª–∏–∑ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤</p>
            </div>
            <button class="music-btn" id="music-toggle">
                <div class="bars">
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                </div>
                <span id="music-text">–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫</span>
            </button>
        </header>

        <div class="main-layout">
            
            <aside class="alma-container">
                <div class="glass-panel alma-avatar">
                    <div class="alma-video-wrapper">
                        <video class="alma-video" autoplay muted loop playsinline>
                            <source src="IMG_5131.MP4" type="video/mp4">
                        </video>
                        <div class="alma-info">
                            <span class="alma-badge">AI Assistant</span>
                            <h2 style="color: white; margin-bottom: 5px;">–ê–ª–º–∞</h2>
                            <p style="color: #cbd5e1; font-size: 0.9rem;">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –≥–∏–¥</p>
                            <button onclick="toggleChat()" style="margin-top: 15px; width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 12px; cursor: pointer; transition: 0.3s;">
                                <i class="fas fa-comment-alt"></i> –°–ø—Ä–æ—Å–∏—Ç—å –ê–ª–º—É
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="glass-panel" style="margin-top: 20px; padding: 1.5rem;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;"><i class="fas fa-brain"></i> AI –ò–Ω—Å–∞–π—Ç</h4>
                    <p style="font-size: 0.9rem; color: #cbd5e1; line-height: 1.6;">
                        "–ú–æ–∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ñ–∏–∫—Å–∏—Ä—É—é—Ç —Ä–µ–∫–æ—Ä–¥–Ω—É—é –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–µ–≥–∏–æ–Ω–∞. –û—Å–Ω–æ–≤–Ω–æ–π –¥—Ä–∞–π–≤–µ—Ä ‚Äî —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ê–ª–º–∞—Ç—ã."
                    </p>
                </div>
            </aside>

            <main>
                <div style="text-align: center;">
                    <nav class="nav-pills">
                        <button class="nav-item active" data-tab="general"><i class="fas fa-chart-line"></i> –ì–ª–∞–≤–Ω–∞—è</button>
                        <button class="nav-item" data-tab="external"><i class="fas fa-globe"></i> –°—Ç—Ä–∞–Ω—ã</button>
                        <button class="nav-item" data-tab="internal"><i class="fas fa-map-marked-alt"></i> –†–∞–π–æ–Ω—ã</button>
                        <button class="nav-item" data-tab="flows"><i class="fas fa-exchange-alt"></i> –ü–æ—Ç–æ–∫–∏</button>
                    </nav>
                </div>

                <section id="general" class="section active">
                    <div class="kpi-grid">
                        <div class="glass-panel kpi-card">
                            <span class="kpi-sub">–°–∞–ª—å–¥–æ 2025</span>
                            <div class="kpi-val">+5,210</div>
                            <span class="kpi-sub trend-up"><i class="fas fa-arrow-up"></i> –ú–∞–∫—Å–∏–º—É–º –∑–∞ 10 –ª–µ—Ç</span>
                        </div>
                        <div class="glass-panel kpi-card">
                            <span class="kpi-sub">–ù–∞—Å–µ–ª–µ–Ω–∏–µ –∞–≥–ª–æ–º–µ—Ä–∞—Ü–∏–∏</span>
                            <div class="kpi-val">2.3M</div>
                            <span class="kpi-sub" style="color: var(--primary);">–ê–∫—Ç–∏–≤–Ω—ã–π —Ä–æ—Å—Ç</span>
                        </div>
                        <div class="glass-panel kpi-card">
                            <span class="kpi-sub">–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç</span>
                            <div class="kpi-val">+4.2%</div>
                            <span class="kpi-sub trend-up">–ö –í–†–ü —Ä–µ–≥–∏–æ–Ω–∞</span>
                        </div>
                    </div>

                    <div class="glass-panel chart-box">
                        <div class="chart-header">
                            <h3>–î–∏–Ω–∞–º–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–∞–ª—å–¥–æ</h3>
                        </div>
                        <canvas id="general-chart"></canvas>
                    </div>

                    <div class="insights-row">
                        <div class="glass-panel insight-box">
                            <div class="insight-title"><i class="fas fa-home"></i> –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∂–∏–ª—å–µ</div>
                            <p style="font-size: 0.9rem; color: var(--text-muted);">–ü—Ä–æ–≥–Ω–æ–∑ —Å–ø—Ä–æ—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∏–≥—Ä–∞—Ü–∏–∏</p>
                            <div style="margin-top: 15px;">
                                <div style="display:flex; justify-content:space-between; font-size: 0.8rem; margin-bottom: 5px;">
                                    <span>–°–ø—Ä–æ—Å –Ω–∞ –∞—Ä–µ–Ω–¥—É</span>
                                    <span style="color: var(--accent);">–í—ã—Å–æ–∫–∏–π (85%)</span>
                                </div>
                                <div class="insight-bar-bg"><div class="insight-bar-fill" style="width: 85%; background: var(--accent);"></div></div>
                            </div>
                        </div>
                        <div class="glass-panel insight-box">
                            <div class="insight-title"><i class="fas fa-briefcase"></i> –†—ã–Ω–æ–∫ —Ç—Ä—É–¥–∞</div>
                            <p style="font-size: 0.9rem; color: var(--text-muted);">–ü—Ä–∏—Ç–æ–∫ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞–¥—Ä–æ–≤</p>
                            <div style="margin-top: 15px;">
                                <div style="display:flex; justify-content:space-between; font-size: 0.8rem; margin-bottom: 5px;">
                                    <span>–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–π</span>
                                    <span style="color: var(--primary);">–°—Ä–µ–¥–Ω–µ–µ (60%)</span>
                                </div>
                                <div class="insight-bar-bg"><div class="insight-bar-fill" style="width: 60%; background: var(--primary);"></div></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="external" class="section">
                    <div class="glass-panel chart-box">
                        <div class="chart-header">
                            <h3><i class="fas fa-globe"></i> –í–Ω–µ—à–Ω—è—è –º–∏–≥—Ä–∞—Ü–∏—è (–¢–æ–ø —Å—Ç—Ä–∞–Ω)</h3>
                            <div class="controls-wrapper">
                                <select id="yearSelect" style="background: rgba(0,0,0,0.3); color: white; border: 1px solid var(--glass-border); padding: 5px 15px; border-radius: 8px;">
                                    <option value="2025">2025</option>
                                    <option value="2024">2024</option>
                                    <option value="2023">2023</option>
                                </select>
                            </div>
                        </div>
                        <canvas id="external-chart"></canvas>
                    </div>
                    <div id="country-insights" class="kpi-grid"></div>
                </section>

                <section id="internal" class="section">
                    <div class="glass-panel chart-box" style="height: auto; padding: 1.5rem;">
                        <h3 style="margin-bottom: 1rem;">–ö–∞—Ä—Ç–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏</h3>
                        <div id="map"></div>
                    </div>
                    <div class="glass-panel" style="padding: 1.5rem; margin-top: 2rem;">
                        <h3>–†–µ–π—Ç–∏–Ω–≥ —Ä–∞–π–æ–Ω–æ–≤ –ø–æ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h3>
                        <table style="width: 100%; margin-top: 1rem; border-collapse: collapse;">
                            <thead>
                                <tr style="color: var(--text-muted); border-bottom: 1px solid var(--glass-border);">
                                    <th style="text-align: left; padding: 10px;">–†–∞–π–æ–Ω</th>
                                    <th style="text-align: right; padding: 10px;">–°–∞–ª—å–¥–æ</th>
                                    <th style="text-align: right; padding: 10px;">–¢—Ä–µ–Ω–¥</th>
                                </tr>
                            </thead>
                            <tbody id="districts-table"></tbody>
                        </table>
                    </div>
                </section>

                <section id="flows" class="section">
                    <div class="glass-panel chart-box">
                        <div class="chart-header">
                            <h3>–ü–æ—Ç–æ–∫–∏: –ü—Ä–∏–±—ã—Ç–∏–µ vs –í—ã–±—ã—Ç–∏–µ</h3>
                            <div style="display: flex; gap: 15px;">
                                <div class="controls-wrapper">
                                    <button class="control-btn view-btn active" data-view="lines"><i class="fas fa-chart-line"></i></button>
                                    <button class="control-btn view-btn" data-view="bars"><i class="fas fa-chart-bar"></i></button>
                                </div>
                                <div class="controls-wrapper">
                                    <button class="control-btn period-btn active" data-period="all">–í—Å–µ</button>
                                    <button class="control-btn period-btn" data-period="recent">10 –ª–µ—Ç</button>
                                    <button class="control-btn period-btn" data-period="five">5 –ª–µ—Ç</button>
                                </div>
                            </div>
                        </div>
                        <canvas id="flows-chart"></canvas>
                        <p style="text-align: center; color: var(--text-muted); font-size: 0.8rem; margin-top: 10px;">
                            <i class="fas fa-mouse-pointer"></i> –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª–µ–≥–µ–Ω–¥—É –≥—Ä–∞—Ñ–∏–∫–∞ (–ü—Ä–∏–±—ã–≤—à–∏–µ/–í—ã–±—ã–≤—à–∏–µ), —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –ª–∏–Ω–∏–∏
                        </p>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <button class="chat-toggle-btn" onclick="toggleChat()"><i class="fas fa-comment"></i></button>
    
    <div class="glass-panel chat-widget" id="chat-window">
        <div class="chat-header">
            <video autoplay muted loop class="chat-avatar-small">
                <source src="IMG_5131.MP4" type="video/mp4">
            </video>
            <div>
                <h3 style="margin: 0; font-size: 1.1rem;">–ê–ª–º–∞</h3>
                <span style="font-size: 0.75rem; color: var(--accent);">‚óè –û–Ω–ª–∞–π–Ω</span>
            </div>
            <button onclick="toggleChat()" style="margin-left: auto; background: none; border: none; color: white; cursor: pointer;"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="chat-body" id="chat-messages">
            </div>
        
        <div class="chat-footer">
            <div class="input-group">
                <input type="text" id="chat-input" placeholder="–°–ø—Ä–æ—Å–∏—Ç–µ –º–µ–Ω—è –æ –º–∏–≥—Ä–∞—Ü–∏–∏...">
                <button class="send-btn" id="send-btn"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA PRESERVATION ---
        const migrationBalanceData = [
            { year: 2000, value: -6151 }, { year: 2001, value: -4344 }, { year: 2002, value: -1116 },
            { year: 2003, value: 3205 }, { year: 2004, value: 5101 }, { year: 2005, value: 5682 },
            { year: 2006, value: 4886 }, { year: 2007, value: 4633 }, { year: 2008, value: 2419 },
            { year: 2009, value: 2501 }, { year: 2010, value: 2466 }, { year: 2011, value: 2592 },
            { year: 2012, value: 973 }, { year: 2013, value: 2432 }, { year: 2014, value: 851 },
            { year: 2015, value: 2290 }, { year: 2016, value: 2571 }, { year: 2017, value: 3593 },
            { year: 2018, value: 1010 }, { year: 2019, value: 973 }, { year: 2020, value: -166 },
            { year: 2021, value: -901 }, { year: 2022, value: 1011 }, { year: 2023, value: 1196 },
            { year: 2024, value: 4367 }, { year: 2025, value: 5210 }
        ];

        const countryMigrationData = {
            2025: [{ name: "–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω", value: 4210 }, { name: "–ö–∏—Ç–∞–π", value: 543 }, { name: "–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω", value: 289 }, { name: "–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω", value: 94 }, { name: "–†–æ—Å—Å–∏—è", value: -112 }, { name: "–ì–µ—Ä–º–∞–Ω–∏—è", value: -92 }, { name: "–¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω", value: 52 }, { name: "–ì—Ä—É–∑–∏—è", value: 68 }, { name: "–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω", value: 71 }, { name: "–¢—É—Ä—Ü–∏—è", value: 45 }],
            2024: [{ name: "–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω", value: 3540 }, { name: "–ö–∏—Ç–∞–π", value: 478 }, { name: "–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω", value: 204 }, { name: "–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω", value: 71 }, { name: "–†–æ—Å—Å–∏—è", value: -86 }, { name: "–ì–µ—Ä–º–∞–Ω–∏—è", value: -78 }, { name: "–¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω", value: 38 }, { name: "–ì—Ä—É–∑–∏—è", value: 49 }, { name: "–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω", value: 54 }, { name: "–¢—É—Ä—Ü–∏—è", value: 32 }],
            2023: [{ name: "–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω", value: 1068 }, { name: "–ö–∏—Ç–∞–π", value: 141 }, { name: "–†–æ—Å—Å–∏—è", value: -195 }, { name: "–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω", value: 88 }, { name: "–ì–µ—Ä–º–∞–Ω–∏—è", value: -75 }, { name: "–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω", value: 53 }, { name: "–¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω", value: 26 }, { name: "–ú–æ–Ω–≥–æ–ª–∏—è", value: 32 }, { name: "–ì—Ä—É–∑–∏—è", value: 53 }, { name: "–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω", value: 24 }]
        };

        const districtMigrationData = [
            { id: "karasay", name: "–ö–∞—Ä–∞—Å–∞–π—Å–∫–∏–π", value: 2541, lat: 43.4, lng: 76.8 },
            { id: "talgarsky", name: "–¢–∞–ª–≥–∞—Ä—Å–∫–∏–π", value: 754, lat: 43.3, lng: 77.2 },
            { id: "iliysky", name: "–ò–ª–∏–π—Å–∫–∏–π", value: 452, lat: 43.6, lng: 76.9 },
            { id: "zhambylysky", name: "–ñ–∞–º–±—ã–ª—Å–∫–∏–π", value: 723, lat: 43.0, lng: 76.5 },
            { id: "enbekshikazakh", name: "–ï–Ω–±–µ–∫—à–∏–∫–∞–∑–∞—Ö—Å–∫–∏–π", value: 289, lat: 43.5, lng: 77.8 },
            { id: "balhashsky", name: "–ë–∞–ª—Ö–∞—à—Å–∫–∏–π", value: -5, lat: 46.0, lng: 75.0 },
            { id: "alatau", name: "–ê–ª–∞—Ç–∞—É –≥.–∞.", value: 82, lat: 43.2, lng: 77.0 },
            { id: "kegen", name: "–ö–µ–≥–µ–Ω—Å–∫–∏–π", value: 2, lat: 43.0, lng: 79.2 },
            { id: "rayymbek", name: "–†–∞–π—ã–º–±–µ–∫—Å–∫–∏–π", value: 3, lat: 42.8, lng: 78.5 },
            { id: "uygur", name: "–£–π–≥—É—Ä—Å–∫–∏–π", value: -3, lat: 43.4, lng: 80.0 },
            { id: "sarkand", name: "–°–∞—Ä–∫–∞–Ω–¥—Å–∫–∏–π", value: 1, lat: 45.0, lng: 79.9 },
            { id: "akkol", name: "–ê–∫–∫–æ–ª—å—Å–∫–∏–π", value: 2, lat: 45.0, lng: 70.0 },
            { id: "koksuy", name: "–ö–æ–∫—Å—É–π—Å–∫–∏–π", value: 1, lat: 44.0, lng: 78.0 },
            { id: "kerbulak", name: "–ö–µ—Ä–±—É–ª–∞–∫—Å–∫–∏–π", value: 0, lat: 44.5, lng: 78.8 },
            { id: "panfilov", name: "–ü–∞–Ω—Ñ–∏–ª–æ–≤—Å–∫–∏–π", value: 1, lat: 44.2, lng: 80.0 },
            { id: "eskeldi", name: "–ï—Å–∫–µ–ª—å–¥–∏–Ω—Å–∫–∏–π", value: 0, lat: 45.0, lng: 78.0 },
            { id: "karatal", name: "–ö–∞—Ä–∞—Ç–∞–ª—å—Å–∫–∏–π", value: 1, lat: 45.5, lng: 78.5 },
            { id: "aksu", name: "–ê–∫—Å—É—Å–∫–∏–π", value: 0, lat: 45.0, lng: 76.0 },
            { id: "almaty", name: "–ê–ª–º–∞—Ç–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", value: 5210, lat: 43.2, lng: 76.9 }
        ];

        const migrationFlowsData = [
            { year: 2000, –ø—Ä–∏–±—ã–≤—à–∏–µ: 2783, –≤—ã–±—ã–≤—à–∏–µ: 8934 }, { year: 2001, –ø—Ä–∏–±—ã–≤—à–∏–µ: 4301, –≤—ã–±—ã–≤—à–∏–µ: 8645 },
            { year: 2002, –ø—Ä–∏–±—ã–≤—à–∏–µ: 6103, –≤—ã–±—ã–≤—à–∏–µ: 7219 }, { year: 2003, –ø—Ä–∏–±—ã–≤—à–∏–µ: 7771, –≤—ã–±—ã–≤—à–∏–µ: 4566 },
            { year: 2004, –ø—Ä–∏–±—ã–≤—à–∏–µ: 8538, –≤—ã–±—ã–≤—à–∏–µ: 3437 }, { year: 2005, –ø—Ä–∏–±—ã–≤—à–∏–µ: 7982, –≤—ã–±—ã–≤—à–∏–µ: 2300 },
            { year: 2006, –ø—Ä–∏–±—ã–≤—à–∏–µ: 6690, –≤—ã–±—ã–≤—à–∏–µ: 1744 }, { year: 2007, –ø—Ä–∏–±—ã–≤—à–∏–µ: 6777, –≤—ã–±—ã–≤—à–∏–µ: 2144 },
            { year: 2008, –ø—Ä–∏–±—ã–≤—à–∏–µ: 3786, –≤—ã–±—ã–≤—à–∏–µ: 1367 }, { year: 2009, –ø—Ä–∏–±—ã–≤—à–∏–µ: 3298, –≤—ã–±—ã–≤—à–∏–µ: 797 },
            { year: 2010, –ø—Ä–∏–±—ã–≤—à–∏–µ: 3212, –≤—ã–±—ã–≤—à–∏–µ: 746 }, { year: 2011, –ø—Ä–∏–±—ã–≤—à–∏–µ: 3463, –≤—ã–±—ã–≤—à–∏–µ: 871 },
            { year: 2012, –ø—Ä–∏–±—ã–≤—à–∏–µ: 1825, –≤—ã–±—ã–≤—à–∏–µ: 852 }, { year: 2013, –ø—Ä–∏–±—ã–≤—à–∏–µ: 3106, –≤—ã–±—ã–≤—à–∏–µ: 674 },
            { year: 2014, –ø—Ä–∏–±—ã–≤—à–∏–µ: 1319, –≤—ã–±—ã–≤—à–∏–µ: 468 }, { year: 2015, –ø—Ä–∏–±—ã–≤—à–∏–µ: 2623, –≤—ã–±—ã–≤—à–∏–µ: 333 },
            { year: 2016, –ø—Ä–∏–±—ã–≤—à–∏–µ: 3055, –≤—ã–±—ã–≤—à–∏–µ: 484 }, { year: 2017, –ø—Ä–∏–±—ã–≤—à–∏–µ: 3913, –≤—ã–±—ã–≤—à–∏–µ: 320 },
            { year: 2018, –ø—Ä–∏–±—ã–≤—à–∏–µ: 1494, –≤—ã–±—ã–≤—à–∏–µ: 484 }, { year: 2019, –ø—Ä–∏–±—ã–≤—à–∏–µ: 1586, –≤—ã–±—ã–≤—à–∏–µ: 613 },
            { year: 2020, –ø—Ä–∏–±—ã–≤—à–∏–µ: 634, –≤—ã–±—ã–≤—à–∏–µ: 800 }, { year: 2021, –ø—Ä–∏–±—ã–≤—à–∏–µ: 76, –≤—ã–±—ã–≤—à–∏–µ: 977 },
            { year: 2022, –ø—Ä–∏–±—ã–≤—à–∏–µ: 1901, –≤—ã–±—ã–≤—à–∏–µ: 890 }, { year: 2023, –ø—Ä–∏–±—ã–≤—à–∏–µ: 1693, –≤—ã–±—ã–≤—à–∏–µ: 497 },
            { year: 2024, –ø—Ä–∏–±—ã–≤—à–∏–µ: 4788, –≤—ã–±—ã–≤—à–∏–µ: 421 }, { year: 2025, –ø—Ä–∏–±—ã–≤—à–∏–µ: 5210, –≤—ã–±—ã–≤—à–∏–µ: 438 }
        ];

        // --- GLOBAL SETTINGS ---
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
        Chart.defaults.font.family = "'Outfit', sans-serif";

        let generalChart, externalChart, flowsChart, map;
        let currentViewMode = 'lines';
        let currentPeriod = 'all';

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            initMusic();
            initTabs();
            initGeneralChart();
            initExternalSection();
            initFlowsSection();
            initMap();
            initChat();
        });

        // --- MUSIC LOGIC ---
        function initMusic() {
            const music = document.getElementById('bg-music');
            const btn = document.getElementById('music-toggle');
            const txt = document.getElementById('music-text');
            
            btn.addEventListener('click', () => {
                if(music.paused) {
                    music.play().then(() => {
                        btn.classList.add('playing');
                        txt.textContent = '–ü–∞—É–∑–∞';
                    });
                } else {
                    music.pause();
                    btn.classList.remove('playing');
                    txt.textContent = '–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫';
                }
            });
        }

        // --- TABS LOGIC ---
        function initTabs() {
            const buttons = document.querySelectorAll('.nav-item');
            const sections = document.querySelectorAll('.section');
            
            buttons.forEach(btn => {
                btn.addEventListener('click', () => {
                    buttons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const target = btn.getAttribute('data-tab');
                    sections.forEach(s => {
                        s.classList.remove('active');
                        if(s.id === target) s.classList.add('active');
                    });
                    
                    if(target === 'internal' && map) setTimeout(() => map.invalidateSize(), 300);
                });
            });
        }

        // --- CHART: GENERAL ---
        function initGeneralChart() {
            const ctx = document.getElementById('general-chart').getContext('2d');
            
            // –ì—Ä–∞–¥–∏–µ–Ω—Ç
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(59, 130, 246, 0.5)');
            gradient.addColorStop(1, 'rgba(59, 130, 246, 0)');

            generalChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: migrationBalanceData.map(d => d.year),
                    datasets: [{
                        label: '–°–∞–ª—å–¥–æ –º–∏–≥—Ä–∞—Ü–∏–∏',
                        data: migrationBalanceData.map(d => d.value),
                        borderColor: '#3b82f6',
                        backgroundColor: gradient,
                        borderWidth: 3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#3b82f6',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#cbd5e1',
                            padding: 10,
                            borderColor: 'rgba(59, 130, 246, 0.3)',
                            borderWidth: 1,
                            displayColors: false
                        }
                    },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.05)' } }
                    }
                }
            });
        }

        // --- SECTION: EXTERNAL ---
        function initExternalSection() {
            const selector = document.getElementById('yearSelect');
            selector.addEventListener('change', updateExternalChart);
            updateExternalChart();
        }

        function updateExternalChart() {
            const year = document.getElementById('yearSelect').value;
            const data = countryMigrationData[year] || countryMigrationData[2025];
            const sorted = [...data].sort((a,b) => b.value - a.value).slice(0, 10); // Top 10

            const ctx = document.getElementById('external-chart').getContext('2d');
            if(externalChart) externalChart.destroy();

            externalChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sorted.map(d => d.name),
                    datasets: [{
                        label: '–ß–µ–ª–æ–≤–µ–∫',
                        data: sorted.map(d => d.value),
                        backgroundColor: sorted.map(d => d.value >= 0 ? '#10b981' : '#ef4444'),
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { grid: { color: 'rgba(255,255,255,0.05)' } } }
                }
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º
            const container = document.getElementById('country-insights');
            container.innerHTML = '';
            sorted.slice(0, 4).forEach(item => {
                const color = item.value >= 0 ? 'var(--accent)' : 'var(--danger)';
                const sign = item.value >= 0 ? '+' : '';
                container.innerHTML += `
                    <div class="glass-panel kpi-card">
                        <span class="kpi-sub">${item.name}</span>
                        <div class="kpi-val" style="font-size: 1.8rem; background: none; -webkit-text-fill-color: ${color}; color: ${color};">${sign}${item.value}</div>
                    </div>
                `;
            });
        }

        // --- SECTION: FLOWS (FIXED BUTTONS) ---
        function initFlowsSection() {
            // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–æ–∫
            const viewBtns = document.querySelectorAll('.view-btn');
            const periodBtns = document.querySelectorAll('.period-btn');

            viewBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    viewBtns.forEach(b => b.classList.remove('active')); // –£–±–∏—Ä–∞–µ–º —É –≤—Å–µ—Ö
                    this.classList.add('active'); // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∂–∞—Ç–æ–π
                    currentViewMode = this.dataset.view;
                    updateFlowsChart();
                });
            });

            periodBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    periodBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPeriod = this.dataset.period;
                    updateFlowsChart();
                });
            });

            updateFlowsChart();
        }

        function updateFlowsChart() {
            let data = migrationFlowsData;
            if(currentPeriod === 'recent') data = data.slice(-10);
            if(currentPeriod === 'five') data = data.slice(-5);

            const ctx = document.getElementById('flows-chart').getContext('2d');
            if(flowsChart) flowsChart.destroy();

            flowsChart = new Chart(ctx, {
                type: currentViewMode === 'lines' ? 'line' : 'bar',
                data: {
                    labels: data.map(d => d.year),
                    datasets: [
                        {
                            label: '–ü—Ä–∏–±—ã–≤—à–∏–µ',
                            data: data.map(d => d.–ø—Ä–∏–±—ã–≤—à–∏–µ),
                            borderColor: '#3b82f6',
                            backgroundColor: currentViewMode === 'bar' ? '#3b82f6' : 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: currentViewMode === 'lines'
                        },
                        {
                            label: '–í—ã–±—ã–≤—à–∏–µ',
                            data: data.map(d => d.–≤—ã–±—ã–≤—à–∏–µ),
                            borderColor: '#ef4444',
                            backgroundColor: currentViewMode === 'bar' ? '#ef4444' : 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: currentViewMode === 'lines'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true, // –í–∫–ª—é—á–∞–µ–º –ª–µ–≥–µ–Ω–¥—É, —á—Ç–æ–±—ã –æ–Ω–∞ –±—ã–ª–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π
                            labels: { color: 'white', usePointStyle: true, padding: 20 },
                            onClick: function(e, legendItem, legend) {
                                const index = legendItem.datasetIndex;
                                const ci = legend.chart;
                                if (ci.isDatasetVisible(index)) {
                                    ci.hide(index);
                                    legendItem.hidden = true;
                                } else {
                                    ci.show(index);
                                    legendItem.hidden = false;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- MAP LOGIC ---
        function initMap() {
            map = L.map('map', { zoomControl: false }).setView([44.5, 78.0], 7);
            L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap &copy; CartoDB'
            }).addTo(map);

            const table = document.getElementById('districts-table');
            const sorted = [...districtMigrationData].sort((a,b) => b.value - a.value);

            sorted.forEach(d => {
                if(d.lat) {
                    const color = d.value > 0 ? '#10b981' : '#ef4444';
                    const radius = Math.min(Math.abs(d.value)/50 + 5, 25);
                    
                    L.circleMarker([d.lat, d.lng], {
                        color: color, fillColor: color, fillOpacity: 0.6, radius: radius, weight: 1
                    }).bindPopup(`<div style="color:black"><b>${d.name}</b><br>–°–∞–ª—å–¥–æ: ${d.value}</div>`).addTo(map);

                    // –¢–∞–±–ª–∏—Ü–∞
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td style="padding: 10px;">${d.name}</td>
                        <td style="padding: 10px; text-align: right; color: ${color}; font-weight: bold;">${d.value > 0 ? '+' : ''}${d.value}</td>
                        <td style="padding: 10px; text-align: right;">${d.value > 0 ? '‚Üó' : '‚Üò'}</td>
                    `;
                    table.appendChild(tr);
                }
            });
        }

        // --- CHAT BOT (ALMA AI) ---
        function toggleChat() {
            document.getElementById('chat-window').classList.toggle('open');
        }

        function initAlmaAI() {
            // === –ù–û–í–ê–Ø –ê–õ–ú–ê –° GEMINI AI ===
const ALMA_KNOWLEDGE = {
    migrationBalance: migrationBalanceData,
    countries: countryMigrationData,
    districts: districtMigrationData,
    flows: migrationFlowsData,
    context: "–ê–ª–º–∞—Ç—ã 2025: —Å–∞–ª—å–¥–æ +5210. –õ–∏–¥–µ—Ä—ã: –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω (+4210), –ö–∏—Ç–∞–π (+543). –†–∞–π–æ–Ω—ã: –ö–∞—Ä–∞—Å–∞–π—Å–∫–∏–π (+2541)"
};

const GEMINI_KEY = "AIzaSyAeCzt2UauImBRLhchYa6uv7irGKqnwrE4"; // ‚Üê –í–°–¢–ê–í–¨ –°–í–û–ô –ö–õ–Æ–ß!

let chatHistory = [];

async function callAlmaAI(message) {
    try {
        const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-latest:generateContent?key=${GEMINI_KEY}`,
            {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `–¢—ã –ê–ª–º–∞ ‚Äî —é–Ω–∞—è –¥–µ–≤—É—à–∫–∞, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –ê–ª–º–∞—Ç–∏–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏. 
                            
                            –•–∞—Ä–∞–∫—Ç–µ—Ä: –¢–µ–ø–ª—ã–π, —é–º–æ—Ä–Ω–æ–π, enfp, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π üåü –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ üìä
                            –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(ALMA_KNOWLEDGE)}
                            
                            –û—Ç–≤–µ—Ç—å –∫—Ä–∞—Ç–∫–æ: 1) –§–∞–∫—Ç 2) üìä –î–∞–Ω–Ω—ã–µ 3) üí° –°–æ–≤–µ—Ç
                            
                            –í–æ–ø—Ä–æ—Å: ${message}`
                        }]
                    }]
                })
            }
        );
        
        const data = await response.json();
        return data.candidates[0].content.parts[0].text;
    } catch (error) {
        return "üåü –ò–∑–≤–∏–Ω–∏, –ø—Ä–æ–≤–µ—Ä—è—é –¥–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏... –°–∞–ª—å–¥–æ 2025: +5210! –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω –ª–∏–¥–∏—Ä—É–µ—Ç üìä";
    }
}

function initAlmaAI() {
    const btn = document.getElementById('send-btn');
    const inp = document.getElementById('chat-input');
    const box = document.getElementById('chat-messages');
    
    function addMsg(text, type) {
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        div.innerHTML = text.replace(/\n/g, '<br>');
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }
    
    async function sendMessage() {
        const text = inp.value.trim();
        if (!text) return;
        
        addMsg(text, 'user');
        inp.value = '';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º "–ø–µ—á–∞—Ç–∞–µ—Ç"
        const typing = document.createElement('div');
        typing.className = 'msg alma';
        typing.innerHTML = '<i>–ê–ª–º–∞ –ø–µ—á–∞—Ç–∞–µ—Ç...</i>';
        box.appendChild(typing);
        box.scrollTop = box.scrollHeight;
        
        // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç Gemini
        const reply = await callAlmaAI(text);
        
        // –£–¥–∞–ª—è–µ–º "–ø–µ—á–∞—Ç–∞–µ—Ç" –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
        box.removeChild(typing);
        addMsg(reply, 'alma');
    }
    
    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ê–ª–º—ã
    addMsg("üåü –°”ô–ª–µ–º! –Ø –ê–ª–º–∞ ‚Äî —Ç–≤–æ–π —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ê–ª–º–∞—Ç—ã 2025 üìä\nüí° –°–∞–ª—å–¥–æ +5210! –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω +4210. –°–ø—Ä–∞—à–∏–≤–∞–π!", 'alma');
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    btn.onclick = sendMessage;
    inp.onkeypress = (e) => e.key === 'Enter' && sendMessage();
}

// –ó–∞–º–µ–Ω—è–µ–º –≤—ã–∑–æ–≤ –≤ –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞
// –ë—ã–ª–æ: initChat();
// –°—Ç–∞–ª–æ: initAlmaAI();

            }
            }

            btn.addEventListener('click', handleSend);
            inp.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleSend(); });
        }
    </script>
</body>
</html>
